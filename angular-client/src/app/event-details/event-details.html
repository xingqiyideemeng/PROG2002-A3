<app-navbar></app-navbar>

<main class="container">
  <div *ngIf="loading" class="loading">Loading event details...</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <section *ngIf="event" class="event-details">
    <div class="event-header">
      <img
        [src]="event.image_url || 'https://picsum.photos/800/400?random=' + event.id"
        [alt]="event.name"
        class="event-detail-image"
      />
      <div class="event-header-info">
        <h2>{{ event.name }}</h2>
        <p class="event-short-desc">{{ event.short_description }}</p>
        <div class="event-meta-large">
          <span class="event-category-badge">{{ event.category_name }}</span>
          <span class="event-org">by {{ event.org_name }}</span>
        </div>
      </div>
    </div>

    <div class="event-content-grid">
      <div class="event-main-content">
        <h3>Event Details</h3>
        <p class="event-full-desc">{{ event.full_description }}</p>

        <div class="event-info-card">
          <h4>Event Information</h4>
          <div class="info-grid">
            <div class="info-item">
              <strong>Date & Time:</strong>
              <span>{{ formatDateTime(event.start_at, event.end_at) }}</span>
            </div>
            <div class="info-item">
              <strong>Venue:</strong>
              <span>{{ event.venue_name }}</span>
            </div>
            <div class="info-item">
              <strong>Location:</strong>
              <span>
                {{ event.venue_address ? event.venue_address + ', ' : '' }}
                {{ event.city }}, {{ event.state_region }} {{ event.postcode }}
              </span>
            </div>
            <div class="info-item">
              <strong>Ticket Price:</strong>
              <span>
                {{ event.ticket_price_cents > 0
                ? ('$' + (event.ticket_price_cents / 100).toFixed(2))
                : 'Free' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="event-sidebar">
        <div class="goal-progress-card" *ngIf="event.goal_amount_cents">
          <h4>Fundraising Goal</h4>
          <div class="progress-container">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width]="(event.amount_raised_cents / event.goal_amount_cents) * 100+ '%'"
              ></div>
            </div>
            <div class="progress-text">
              ${{ (event.amount_raised_cents / 100).toFixed(2) }} raised of
              ${{ (event.goal_amount_cents / 100).toFixed(2) }} goal
            </div>
          </div>
        </div>

        <div class="ticket-info-card">
          <h4>Ticket Information</h4>
          <p>
            {{
            event.tickets_total
              ? event.tickets_sold + ' of ' + event.tickets_total + ' tickets sold'
              : event.tickets_sold + ' tickets sold'
            }}
          </p>
          <button class="register-btn" (click)="openModal()">Register Now</button>
        </div>

        <div class="org-contact-card">
          <h4>Organizer Contact</h4>
          <p>Email: {{ event.contact_email }} | Phone: {{ event.contact_phone }}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- 注册模态框 -->
  <div class="modal" *ngIf="showModalFlag">
    <div class="modal-content">
      <span class="close-btn" (click)="closeModal()">&times;</span>
      <div class="modal-header">
        <h3>🎉 注册活动</h3>
      </div>
      <div class="modal-body">
        <div class="construction-animation">
          <div class="construction-icon">🚧</div>
          <h4>此功能正在积极构建中</h4>
          <p>
            我们的开发团队正在努力打造完美的注册体验。请稍后再回来查看这个令人兴奋的新功能！
          </p>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 65%"></div>
            </div>
            <span class="progress-text">开发进度: 65%</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-primary" (click)="closeModal()">太棒了，期待中！</button>
        <button class="btn-secondary" (click)="closeModal()">稍后提醒我</button>
      </div>
    </div>
  </div>
</main>
