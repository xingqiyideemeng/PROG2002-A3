<div class="registrations-page">
  <div class="page-header">
    <button class="btn-primary" (click)="openCreateModal()">Add Registration</button>
  </div>

  <div *ngIf="loading" class="loading">Loading registrations...</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <table *ngIf="!loading && registrations.length > 0" class="table">
    <thead>
    <tr>
      <th>ID</th>
      <th>Event</th>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Tickets</th>
      <th>Registered At</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let r of registrations">
      <td>{{ r.id }}</td>
      <td>{{ r.event_name || r.event_id }}</td>
      <td>{{ r.full_name }}</td>
      <td>{{ r.email }}</td>
      <td>{{ r.contact_phone || '-' }}</td>
      <td>{{ r.tickets_count }}</td>
      <td>{{ r.registered_at | date:'short' }}</td>
      <td>
        <button class="btn-secondary" (click)="editRegistration(r)">Edit</button>
        <button class="btn-secondary" (click)="deleteRegistration(r.id)">Delete</button>
      </td>
    </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && registrations.length === 0" class="loading">No registrations found.</div>

  <!-- 新增/编辑模态框 -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ isEditMode ? 'Edit Registration' : 'Add Registration' }}</h3>
        <span class="close-btn" (click)="closeModal()">&times;</span>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>Event</label>
          <select [(ngModel)]="currentReg.event_id">
            <option *ngFor="let event of events" [value]="event.id">{{event.name}}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Full name</label>
          <input type="text" [(ngModel)]="currentReg.full_name" placeholder="Full name">
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="currentReg.email" placeholder="Email">
        </div>

        <div class="form-group">
          <label>Contact phone</label>
          <input type="text" [(ngModel)]="currentReg.contact_phone" placeholder="Contact phone">
        </div>

        <div class="form-group">
          <label>Tickets count</label>
          <input type="number" [(ngModel)]="currentReg.tickets_count" min="1" placeholder="Tickets count">
        </div>

        <div *ngIf="formErrorMessage" class="error-message">{{ formErrorMessage }}</div>
      </div>

      <div class="modal-footer">
        <button class="btn-primary" (click)="saveRegistration()">{{ isEditMode ? 'Update' : 'Create' }}</button>
        <button class="btn-secondary" (click)="closeModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>
